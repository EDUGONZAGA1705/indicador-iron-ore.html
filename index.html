<script>
  let chart;

  const dummyData = {
    price: 277.55,
    changePercent: 0.21,
    changeValue: 0.58,
    history: [245, 250, 255, 248, 260, 263, 267, 270, 273, 275, 276, 277.55],
    labels: [
      "Dez", "Jan", "Fev", "Mar", "Abr", "Mai",
      "Jun", "Jul", "Ago", "Set", "Out", "Nov"
    ]
  };

  function renderChart(data) {
    const ctx = document.getElementById('chart').getContext('2d');
    if (chart) chart.destroy();

    const isPositive = data.changeValue >= 0;
    const gradient = ctx.createLinearGradient(0, 0, 0, 150);
    if (isPositive) {
      gradient.addColorStop(0, 'rgba(40, 167, 69, 0.4)');
      gradient.addColorStop(1, 'rgba(40, 167, 69, 0)');
    } else {
      gradient.addColorStop(0, 'rgba(220, 53, 69, 0.4)');
      gradient.addColorStop(1, 'rgba(220, 53, 69, 0)');
    }

    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.labels,
        datasets: [{
          data: data.history,
          borderColor: isPositive ? '#28a745' : '#dc3545',
          backgroundColor: gradient,
          fill: true,
          tension: 0.3,
          pointRadius: 0
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { color: '#888' }, display: false },
          y: { ticks: { color: '#888' }, display: false }
        }
      }
    });
  }

  function updateData() {
    const novoPreco = parseFloat((270 + Math.random() * 10).toFixed(2));
    const anterior = dummyData.history.at(-1);
    const novaDiferenca = (novoPreco - anterior).toFixed(2);
    const novaVariacao = ((novaDiferenca / anterior) * 100).toFixed(2);
    const isPositive = novaDiferenca >= 0;

    dummyData.price = novoPreco;
    dummyData.changePercent = novaVariacao;
    dummyData.changeValue = novaDiferenca;
    dummyData.history.shift();
    dummyData.history.push(novoPreco);

    document.getElementById("price").innerText = novoPreco;
    document.getElementById("change").innerText =
      `${isPositive ? '+' : ''}${novaVariacao}% (${novaDiferenca})`;
    document.getElementById("change").style.color = isPositive ? '#28a745' : '#dc3545';

    renderChart(dummyData);
  }

  renderChart(dummyData);
</script>
</body>
</html>
